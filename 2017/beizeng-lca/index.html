<!DOCTYPE html><html><!DOCTYPE html><head><title>倍增LCA | 潮与雪 - Rapiz</title><link rel="stylesheet" href="/css/style.css"><script src="/js/utils.js"></script><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="robots" content="index,follow"><meta name="author" content="Rapiz"><meta name="keywords" content="潮与雪,Rapiz,Rapiz,OI,ACM,HUST,乔羽佳,博客,Blog,算法,开源软件,题解,树,倍增,OI"><meta name="description" content="潮与雪,Rapiz,凡人难以承受生活全部的真相，于是他们各执一端。,Rapiz,倍增LCA,会 ST 表和树剖了，为什么还要学倍增 LCA：需要的信息很少，代码很短。"><meta name="viewport" content="width=device-width,initial-scale=1"><script src="https://cdn.jsdelivr.net/npm/mermaid@8.5.1/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"neutral"})</script><meta name="generator" content="Hexo 5.0.2"><link rel="alternate" href="/atom.xml" title="潮与雪" type="application/atom+xml"><link rel="alternate" href="/rss2.xml" title="潮与雪" type="application/rss+xml"></head><body><script src="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/components/prism-core.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.20.0/plugins/autoloader/prism-autoloader.min.js"></script><div id="wrap"><header id="header"><div id="nav"><div id="nav-items"><div class="underline-trans"><a href="/">Home</a></div><div class="underline-trans"><a href="/links">Links</a></div><div class="underline-trans"><a href="/portal">About</a></div></div></div></header><main class="main" onchange="FanfouFix()"><article class="post markdown-body"><div class="post-title"><h1 class="title">倍增LCA</h1></div><div class="post-meta"><blockquote>会 ST 表和树剖了，为什么还要学倍增 LCA：需要的信息很少，代码很短。</blockquote><span>In <a class="post-category-link" href="/categories/OI/">OI</a> </span><span class="post-author">By Rapiz</span> <span class="post-time">2017-02-01</span> <span class="post-tags"><a class="article-tag-none-link" href="/tags/%E5%80%8D%E5%A2%9E/" rel="tag">倍增</a>, <a class="article-tag-none-link" href="/tags/%E6%A0%91/" rel="tag">树</a></span></div><div class="post-content"><p></p><p>你可能遇到过这种情况，需要用到 LCA， 但是写一个 ST 表 + RMQ 多了一个欧拉序数组、一个<code>sz</code>变量、一个或两个函数，如果仅仅为 LCA 写树剖就太兴师动众了，这就很不爽。</p><p>这时候你需要倍增 LCA。<br>而倍增 LCA 需要的信息仅仅是 <code>anc[][]</code> 和 <code>dep[]</code>，<code>anc[][]</code> 可以替换 <code>fa[]</code> 的位置, <code>dep[]</code> 往往是写不写 LCA 都要维护的常见量。</p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.cnblogs.com/wuminye/p/3532397.html">算法过程很简单, 想学看这里。</a><em>&lt;-这篇文章过程讲的很好，代码太长太丑。</em></p><p>所以代码也很简单。<br>我们只多写了一行来维护<code>anc[]</code>。<br>LCA 还是要写一个函数的。</p><pre><code class="lang-c++">void dfs(int u) &amp;#123;
    for (int i = 1; i &lt; K; i++) anc[u][i] = anc[anc[u][i - 1]][i - 1];
    for (int e = hed[u]; e; e = nxt[e]) &amp;#123;
        int v = st[e].v;
        if (v == anc[u][0]) continue;
        dep[v] = dep[u] + 1;
    anc[v][0] = u;
        dfs(v, u);
    &amp;#125;
&amp;#125;
int lca(int u, int v) &amp;#123;
    if (dep[u] &lt; dep[v]) swap(u, v);
    for (int d = dep[u] - dep[v], k = 0; d; d &gt;&gt;= 1, k++) if (d&amp;1) u = anc[u][k]; //达到统一深度
    //下面这个循环必须从大到小。考虑二进制下 1 + 1 = 10
    for (int k = K - 1; k &gt;= 0; k--) if (anc[u][k] != anc[v][k])
        u = anc[u][k], v = anc[v][k];
    return u == v ? u : anc[u][0];
&amp;#125;
</code></pre></div></article><div class="page-nav"><div class="underline-trans"><a href="/2017/WC2017/">◀ WC 2017 爆零流水帐</a></div><div class="underline-trans"><a href="/2017/motao-shang-shu/">树上莫队和树上分块 ▶</a></div></div><section id="comments"><div id="disqus_thread"><script type="text/javascript">var disqus_shortname="rapiz";function loadDisqus(){var e=document,n=e.createElement("script");n.src="https://"+disqus_shortname+".disqus.com/embed.js",n.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(n),window.disqus_config=function(){this.page.url="https://rapiz.me/2017/beizeng-lca/",this.page.identifier="/2017/beizeng-lca/"}}var runningOnBrowser="undefined"!=typeof window,isBot=runningOnBrowser&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent),supportsIntersectionObserver=runningOnBrowser&&"IntersectionObserver"in window;setTimeout(function(){var n;!isBot&&supportsIntersectionObserver?(n=new IntersectionObserver(function(e){e[0].isIntersecting&&(loadDisqus(),n.disconnect())},{threshold:[0]})).observe(document.getElementById("disqus_thread")):loadDisqus()},1)</script><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div></section></main><div id="typography-footer"><p>Powered by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/">Hexo</a> | <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Rapiz1/typography">Typography</a> designed by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/Rapiz1">Rapiz</a></p></div></div><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });</script><script src=https://cdn.jsdelivr.net/npm/mathjax@2.7.8/MathJax.js?config=TeX-AMS-MML_HTMLorMML></body></html>